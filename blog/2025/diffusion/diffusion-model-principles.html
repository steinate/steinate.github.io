<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>扩散模型(Diffusion Model)原理推导 | 技术博客</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <!-- Tailwind 配置 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#10B981',
                        dark: '#1E293B',
                        light: '#F8FAFC'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                        serif: ['Georgia', 'serif'],
                        mono: ['Consolas', 'Monaco', 'monospace']
                    },
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .text-balance {
                text-wrap: balance;
            }
            .math-display {
                @apply my-6;
            }
            .section-fade {
                @apply opacity-0 transform translate-y-4 transition-all duration-700 ease-out;
            }
            .section-visible {
                @apply opacity-100 transform translate-y-0;
            }
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 font-sans">
    <!-- 导航栏 -->
    <header class="sticky top-0 z-50 bg-white/90 backdrop-blur-sm shadow-sm transition-all duration-300">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <i class="fa fa-line-chart text-primary text-2xl"></i>
                <h1 class="text-xl font-bold text-dark">扩散模型详解</h1>
            </div>
            
            <!-- 桌面导航 -->
            <nav class="hidden md:flex items-center space-x-6">
                <a href="#intro" class="text-gray-600 hover:text-primary transition-colors">简介</a>
                <a href="#forward" class="text-gray-600 hover:text-primary transition-colors">前向扩散</a>
                <a href="#reverse" class="text-gray-600 hover:text-primary transition-colors">逆向扩散</a>
                <a href="#training" class="text-gray-600 hover:text-primary transition-colors">训练目标</a>
                <a href="#sampling" class="text-gray-600 hover:text-primary transition-colors">采样过程</a>
                <a href="#extensions" class="text-gray-600 hover:text-primary transition-colors">扩展与应用</a>
            </nav>
            
            <!-- 移动端菜单按钮 -->
            <button id="menuBtn" class="md:hidden text-gray-600 hover:text-primary">
                <i class="fa fa-bars text-xl"></i>
            </button>
        </div>
        
        <!-- 移动端导航菜单 -->
        <div id="mobileMenu" class="hidden md:hidden bg-white border-t border-gray-200">
            <div class="container mx-auto px-4 py-2 flex flex-col space-y-3">
                <a href="#intro" class="py-2 text-gray-600 hover:text-primary transition-colors">简介</a>
                <a href="#forward" class="py-2 text-gray-600 hover:text-primary transition-colors">前向扩散</a>
                <a href="#reverse" class="py-2 text-gray-600 hover:text-primary transition-colors">逆向扩散</a>
                <a href="#training" class="py-2 text-gray-600 hover:text-primary transition-colors">训练目标</a>
                <a href="#sampling" class="py-2 text-gray-600 hover:text-primary transition-colors">采样过程</a>
                <a href="#extensions" class="py-2 text-gray-600 hover:text-primary transition-colors">扩展与应用</a>
            </div>
        </div>
    </header>

    <!-- 主内容 -->
    <main class="container mx-auto px-4 py-8 md:py-12">
        <!-- 博客标题区域 -->
        <div class="text-center max-w-4xl mx-auto mb-16 section-fade">
            <span class="inline-block px-3 py-1 bg-blue-100 text-primary rounded-full text-sm font-medium mb-4">
                深度学习 · 生成模型
            </span>
            <h1 class="text-4xl md:text-5xl font-bold mb-6 text-dark leading-tight">
                扩散模型(Diffusion Model)的<br class="md:hidden">数学原理与推导
            </h1>
            <p class="text-gray-600 text-lg md:text-xl mb-8 text-balance">
                从基础概念到数学推导，全面解析扩散模型的工作原理
            </p>
            <div class="flex items-center justify-center space-x-4">
                <img src="https://picsum.photos/id/1005/40/40" alt="作者头像" class="w-10 h-10 rounded-full">
                <div class="text-left">
                    <p class="font-medium">AI技术研究员</p>
                    <p class="text-sm text-gray-500">发布于 2023年10月15日 · 阅读时间: 25分钟</p>
                </div>
            </div>
        </div>

        <!-- 目录 -->
        <div class="max-w-4xl mx-auto mb-16 bg-white rounded-xl shadow-sm p-6 border border-gray-100 section-fade">
            <h2 class="text-xl font-bold mb-4 flex items-center">
                <i class="fa fa-list-ul text-primary mr-2"></i> 文章目录
            </h2>
            <ul class="space-y-2 text-gray-700">
                <li class="flex items-center">
                    <i class="fa fa-angle-right text-primary mr-2"></i>
                    <a href="#intro" class="hover:text-primary transition-colors">扩散模型简介</a>
                </li>
                <li class="flex items-center">
                    <i class="fa fa-angle-right text-primary mr-2"></i>
                    <a href="#forward" class="hover:text-primary transition-colors">前向扩散过程</a>
                </li>
                <li class="flex items-center">
                    <i class="fa fa-angle-right text-primary mr-2"></i>
                    <a href="#reverse" class="hover:text-primary transition-colors">逆向扩散过程</a>
                </li>
                <li class="flex items-center">
                    <i class="fa fa-angle-right text-primary mr-2"></i>
                    <a href="#training" class="hover:text-primary transition-colors">训练目标与损失函数</a>
                </li>
                <li class="flex items-center">
                    <i class="fa fa-angle-right text-primary mr-2"></i>
                    <a href="#sampling" class="hover:text-primary transition-colors">采样过程</a>
                </li>
                <li class="flex items-center">
                    <i class="fa fa-angle-right text-primary mr-2"></i>
                    <a href="#extensions" class="hover:text-primary transition-colors">扩展模型与实际应用</a>
                </li>
                <li class="flex items-center">
                    <i class="fa fa-angle-right text-primary mr-2"></i>
                    <a href="#summary" class="hover:text-primary transition-colors">总结与展望</a>
                </li>
            </ul>
        </div>

        <!-- 正文内容 -->
        <div class="max-w-4xl mx-auto space-y-12">
            <!-- 1. 扩散模型简介 -->
            <section id="intro" class="section-fade">
                <div class="flex items-center mb-6">
                    <div class="w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center mr-4">
                        <i class="fa fa-info text-primary"></i>
                    </div>
                    <h2 class="text-3xl font-bold text-dark">扩散模型简介</h2>
                </div>
                
                <p class="text-gray-700 mb-6 leading-relaxed">
                    扩散模型(Diffusion Model)是一类基于概率模型的生成式人工智能模型，近年来在图像生成、语音合成等领域取得了突破性进展。与GANs(生成对抗网络)和VAEs(变分自编码器)等其他生成模型相比，扩散模型具有训练稳定、生成质量高的特点。
                </p>
                
                <p class="text-gray-700 mb-6 leading-relaxed">
                    扩散模型的核心思想源于非平衡热力学，其工作原理可以分为两个主要过程：
                </p>
                
                <div class="grid md:grid-cols-2 gap-6 mb-8">
                    <div class="bg-blue-50 p-6 rounded-lg border border-blue-100">
                        <h3 class="text-lg font-semibold text-primary mb-3 flex items-center">
                            <i class="fa fa-forward mr-2"></i> 前向扩散过程
                        </h3>
                        <p class="text-gray-700">
                            逐步向数据中添加高斯噪声，直到数据变成完全随机的噪声。这个过程是一个马尔可夫链，每一步只依赖于前一步的结果。
                        </p>
                    </div>
                    
                    <div class="bg-green-50 p-6 rounded-lg border border-green-100">
                        <h3 class="text-lg font-semibold text-secondary mb-3 flex items-center">
                            <i class="fa fa-backward mr-2"></i> 逆向扩散过程
                        </h3>
                        <p class="text-gray-700">
                            从纯噪声开始，通过一个神经网络学习逐步去除噪声，最终恢复出有意义的数据。这个过程是前向扩散的逆过程。
                        </p>
                    </div>
                </div>
                
                <div class="my-8">
                    <div class="bg-white p-1 rounded-lg shadow-sm mb-4">
                        <canvas id="diffusionChart" width="400" height="200"></canvas>
                    </div>
                    <p class="text-sm text-gray-500 text-center">图1: 扩散模型的前向和逆向过程示意图</p>
                </div>
                
                <p class="text-gray-700 leading-relaxed">
                    扩散模型的概念最早可以追溯到2015年的论文《Deep Unsupervised Learning using Nonequilibrium Thermodynamics》，但直到2020年《Denoising Diffusion Probabilistic Models》(DDPM)一文发表后，才真正引起广泛关注并成为生成模型领域的研究热点。
                </p>
            </section>

            <!-- 2. 前向扩散过程 -->
            <section id="forward" class="section-fade">
                <div class="flex items-center mb-6">
                    <div class="w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center mr-4">
                        <i class="fa fa-forward text-primary"></i>
                    </div>
                    <h2 class="text-3xl font-bold text-dark">前向扩散过程</h2>
                </div>
                
                <p class="text-gray-700 mb-6 leading-relaxed">
                    前向扩散过程是一个确定性的、逐渐向数据中添加噪声的过程。我们从原始数据分布\( q(\mathbf{x}_0) \)开始，通过T步逐步添加高斯噪声，最终得到一个近似标准正态分布的噪声\( \mathbf{x}_T \)。
                </p>
                
                <h3 class="text-xl font-semibold mb-4 text-dark">2.1 扩散过程定义</h3>
                
                <p class="text-gray-700 mb-4 leading-relaxed">
                    前向扩散过程被定义为一个马尔可夫链，其中每一步的噪声添加遵循以下规则：
                </p>
                
                <div class="math-display">
                    \[
                    q(\mathbf{x}_t | \mathbf{x}_{t-1}) = \mathcal{N}(\mathbf{x}_t; \sqrt{1 - \beta_t} \mathbf{x}_{t-1}, \beta_t \mathbf{I})
                    \]
                </div>
                
                <p class="text-gray-700 mb-4 leading-relaxed">
                    其中\( \beta_t \in (0, 1) \)是一个预先设定的噪声调度参数，且满足\( \beta_1 < \beta_2 < \dots < \beta_T \)。这意味着随着t的增加，我们添加的噪声越来越多。
                </p>
                
                <h3 class="text-xl font-semibold mb-4 text-dark">2.2 扩散过程的闭式解</h3>
                
                <p class="text-gray-700 mb-4 leading-relaxed">
                    虽然扩散过程是逐步进行的，但我们可以推导出从\( \mathbf{x}_0 \)直接到\( \mathbf{x}_t \)的闭式表达式，这对于后续的模型训练非常重要。
                </p>
                
                <p class="text-gray-700 mb-4 leading-relaxed">
                    首先，我们定义：
                </p>
                
                <div class="math-display">
                    \[
                    \alpha_t = 1 - \beta_t, \quad \bar{\alpha}_t = \prod_{s=1}^t \alpha_s
                    \]
                </div>
                
                <p class="text-gray-700 mb-4 leading-relaxed">
                    通过数学归纳法，我们可以证明：
                </p>
                
                <div class="math-display">
                    \[
                    q(\mathbf{x}_t | \mathbf{x}_0) = \mathcal{N}(\mathbf{x}_t; \sqrt{\bar{\alpha}_t} \mathbf{x}_0, (1 - \bar{\alpha}_t) \mathbf{I})
                    \]
                </div>
                
                <p class="text-gray-700 mb-4 leading-relaxed">
                    证明过程如下：
                </p>
                
                <p class="text-gray-700 mb-4 leading-relaxed">
                    当t=1时，显然成立：
                </p>
                
                <div class="math-display">
                    \[
                    q(\mathbf{x}_1 | \mathbf{x}_0) = \mathcal{N}(\mathbf{x}_1; \sqrt{\alpha_1} \mathbf{x}_0, \beta_1 \mathbf{I}) = \mathcal{N}(\mathbf{x}_1; \sqrt{\bar{\alpha}_1} \mathbf{x}_0, (1 - \bar{\alpha}_1) \mathbf{I})
                    \]
                </div>
                
                <p class="text-gray-700 mb-4 leading-relaxed">
                    假设对于t-1成立，即：
                </p>
                
                <div class="math-display">
                    \[
                    q(\mathbf{x}_{t-1} | \mathbf{x}_0) = \mathcal{N}(\mathbf{x}_{t-1}; \sqrt{\bar{\alpha}_{t-1}} \mathbf{x}_0, (1 - \bar{\alpha}_{t-1}) \mathbf{I})
                    \]
                </div>
                
                <p class="text-gray-700 mb-4 leading-relaxed">
                    对于t，我们有：
                </p>
                
                <div class="math-display">
                    \[
                    \mathbf{x}_t = \sqrt{\alpha_t} \mathbf{x}_{t-1} + \sqrt{1 - \alpha_t} \boldsymbol{\epsilon}
                    \]
                </div>
                
                <p class="text-gray-700 mb-4 leading-relaxed">
                    其中\( \boldsymbol{\epsilon} \sim \mathcal{N}(\mathbf{0}, \mathbf{I}) \)。将假设中的\( \mathbf{x}_{t-1} \)代入：
                </p>
                
                <div class="math-display">
                    \[
                    \mathbf{x}_t = \sqrt{\alpha_t \bar{\alpha}_{t-1}} \mathbf{x}_0 + \sqrt{\alpha_t (1 - \bar{\alpha}_{t-1})} \boldsymbol{\epsilon}' + \sqrt{1 - \alpha_t} \boldsymbol{\epsilon}
                    \]
                </div>
                
                <p class="text-gray-700 mb-4 leading-relaxed">
                    由于两个独立高斯变量的和仍然是高斯变量，其均值为两个均值的和，方差为两个方差的和：
                </p>
                
                <div class="math-display">
                    \[
                    \text{mean} = \sqrt{\alpha_t \bar{\alpha}_{t-1}} \mathbf{x}_0 = \sqrt{\bar{\alpha}_t} \mathbf{x}_0
                    \]
                </div>
                
                <div class="math-display">
                    \[
                    \text{variance} = \alpha_t (1 - \bar{\alpha}_{t-1}) + (1 - \alpha_t) = 1 - \alpha_t \bar{\alpha}_{t-1} = 1 - \bar{\alpha}_t
                    \]
                </div>
                
                <p class="text-gray-700 mb-4 leading-relaxed">
                    因此，对于t，结论也成立，由归纳法可知闭式解对所有t成立。
                </p>
                
                <h3 class="text-xl font-semibold mb-4 text-dark">2.3 噪声的重新参数化</h3>
                
                <p class="text-gray-700 mb-4 leading-relaxed">
                    根据上述闭式解，我们可以将\( \mathbf{x}_t \)表示为：
                </p>
                
                <div class="math-display">
                    \[
                    \mathbf{x}_t = \sqrt{\bar{\alpha}_t} \mathbf{x}_0 + \sqrt{1 - \bar{\alpha}_t} \boldsymbol{\epsilon}, \quad \boldsymbol{\epsilon} \sim \mathcal{N}(\mathbf{0}, \mathbf{I})
                    \]
                </div>
                
                <p class="text-gray-700 leading-relaxed">
                    这个表达式非常重要，它表明我们可以直接从\( \mathbf{x}_0 \)和随机噪声\( \boldsymbol{\epsilon} \)计算出任意时刻t的\( \mathbf{x}_t \)，而无需逐步计算从1到t的每一步。这为后续的模型训练提供了极大的便利。
                </p>
            </section>

            <!-- 3. 逆向扩散过程 -->
            <section id="reverse" class="section-fade">
                <div class="flex items-center mb-6">
                    <div class="w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center mr-4">
                        <i class="fa fa-backward text-primary"></i>
                    </div>
                    <h2 class="text-3xl font-bold text-dark">逆向扩散过程</h2>
                </div>
                
                <p class="text-gray-700 mb-6 leading-relaxed">
                    逆向扩散过程是前向扩散的逆过程，其目标是从噪声\( \mathbf{x}_T \)开始，逐步去除噪声，最终恢复出与原始数据分布\( q(\mathbf{x}_0) \)相似的样本。
                </p>
                
                <h3 class="text-xl font-semibold mb-4 text-dark">3.1 逆向过程的定义</h3>
                
                <p class="text-gray-700 mb-4 leading-relaxed">
                    逆向扩散过程同样被定义为一个马尔可夫链，其转移概率为：
                </p>
                
                <div class="math-display">
                    \[
                    p_\theta(\mathbf{x}_{t-1} | \mathbf{x}_t) = \mathcal{N}(\mathbf{x}_{t-1}; \boldsymbol{\mu}_\theta(\mathbf{x}_t, t), \boldsymbol{\Sigma}_\theta(\mathbf{x}_t, t))
                    \]
                </div>
                
                <p class="text-gray-700 mb-4 leading-relaxed">
                    其中\( \boldsymbol{\mu}_\theta \)和\( \boldsymbol{\Sigma}_\theta \)是由神经网络参数化的均值和协方差矩阵。在DDPM中，协方差矩阵被简化为一个对角矩阵，并且可以是固定的或由网络预测的。
                </p>
                
                <h3 class="text-xl font-semibold mb-4 text-dark">3.2 逆向过程的后验分布</h3>
                
                <p class="text-gray-700 mb-4 leading-relaxed">
                    为了推导逆向过程的参数，我们需要计算后验分布\( q(\mathbf{x}_{t-1} | \mathbf{x}_t, \mathbf{x}_0) \)。根据贝叶斯定理：
                </p>
                
                <div class="math-display">
                    \[
                    q(\mathbf{x}_{t-1} | \mathbf{x}_t, \mathbf{x}_0) = \frac{q(\mathbf{x}_t | \mathbf{x}_{t-1}, \mathbf{x}_0) q(\mathbf{x}_{t-1} | \mathbf{x}_0)}{q(\mathbf{x}_t | \mathbf{x}_0)}
                    \]
                </div>
                
                <p class="text-gray-700 mb-4 leading-relaxed">
                    由于前向过程是马尔可夫链，\( q(\mathbf{x}_t | \mathbf{x}_{t-1}, \mathbf{x}_0) = q(\mathbf{x}_t | \mathbf{x}_{t-1}) \)。代入前向过程的定义：
                </p>
                
                <div class="math-display">
                    \[
                    q(\mathbf{x}_{t-1} | \mathbf{x}_t, \mathbf{x}_0) \propto \exp\left( -\frac{1}{2} \left[ \frac{(\mathbf{x}_t - \sqrt{\alpha_t} \mathbf{x}_{t-1})^2}{\beta_t} + \frac{(\mathbf{x}_{t-1} - \sqrt{\bar{\alpha}_{t-1}} \mathbf{x}_0)^2}{1 - \bar{\alpha}_{t-1}} - \frac{(\mathbf{x}_t - \sqrt{\bar{\alpha}_t} \mathbf{x}_0)^2}{1 - \bar{\alpha}_t} \right] \right)
                    \]
                </div>
                
                <p class="text-gray-700 mb-4 leading-relaxed">
                    通过完成平方运算，可以证明这个后验分布是一个高斯分布：
                </p>
                
                <div class="math-display">
                    \[
                    q(\mathbf{x}_{t-1} | \mathbf{x}_t, \mathbf{x}_0) = \mathcal{N}(\mathbf{x}_{t-1}; \boldsymbol{\mu}_t(\mathbf{x}_t, \mathbf{x}_0), \beta_t \mathbf{I})
                    \]
                </div>
                
                <p class="text-gray-700 mb-4 leading-relaxed">
                    其中均值\( \boldsymbol{\mu}_t \)为：
                </p>
                
                <div class="math-display">
                    \[
                    \boldsymbol{\mu}_t(\mathbf{x}_t, \mathbf{x}_0) = \frac{\sqrt{\alpha_t}(1 - \bar{\alpha}_{t-1})}{1 - \bar{\alpha}_t} \mathbf{x}_t + \frac{\sqrt{\bar{\alpha}_{t-1}} \beta_t}{1 - \bar{\alpha}_t} \mathbf{x}_0
                    \]
                </div>
                
                <h3 class="text-xl font-semibold mb-4 text-dark">3.3 用噪声表示的均值</h3>
                
                <p class="text-gray-700 mb-4 leading-relaxed">
                    利用前向过程中\( \mathbf{x}_0 \)和\( \mathbf{x}_t \)的关系\( \mathbf{x}_0 = \frac{\mathbf{x}_t - \sqrt{1 - \bar{\alpha}_t} \boldsymbol{\epsilon}}{\sqrt{\bar{\alpha}_t}} \)，我们可以将均值\( \boldsymbol{\mu}_t \)重新表示为：
                </p>
                
                <div class="math-display">
                    \[
                    \boldsymbol{\mu}_t(\mathbf{x}_t, \boldsymbol{\epsilon}) = \frac{1}{\sqrt{\alpha_t}} \left( \mathbf{x}_t - \frac{\beta_t}{\sqrt{1 - \bar{\alpha}_t}} \boldsymbol{\epsilon} \right)
                    \]
                </div>
                
                <p class="text-gray-700 leading-relaxed">
                    这个表达式揭示了一个重要 insight：如果我们能够预测出噪声\( \boldsymbol{\epsilon} \)，就可以计算出逆向过程的均值，从而从\( \mathbf{x}_t \)得到\( \mathbf{x}_{t-1} \)。这正是扩散模型训练的核心思想。
                </p>
            </section>

            <!-- 4. 训练目标与损失函数 -->
            <section id="training" class="section-fade">
                <div class="flex items-center mb-6">
                    <div class="w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center mr-4">
                        <i class="fa fa-cogs text-primary"></i>
                    </div>
                    <h2 class="text-3xl font-bold text-dark">训练目标与损失函数</h2>
                </div>
                
                <p class="text-gray-700 mb-6 leading-relaxed">
                    扩散模型的训练目标是最大化边际似然\( p_\theta(\mathbf{x}_0) \)的对数。然而，直接优化这个目标是不可行的，因此我们需要找到一个可计算的替代目标。
                </p>
                
                <h3 class="text-xl font-semibold mb-4 text-dark">4.1 证据下界(ELBO)</h3>
                
                <p class="text-gray-700 mb-4 leading-relaxed">
                    利用 Jensen不等式，我们可以得到对数似然的一个下界，称为证据下界(ELBO)：
                </p>
                
                <div class="math-display">
                    \[
                    \log p_\theta(\mathbf{x}_0) \geq \mathbb{E}_{q(\mathbf{x}_{1:T} | \mathbf{x}_0)} \left[ \log \frac{p_\theta(\mathbf{x}_0, \mathbf{x}_{1:T})}{q(\mathbf{x}_{1:T} | \mathbf{x}_0)} \right] =: \mathcal{L}
                    \]
                </div>
                
                <p class="text-gray-700 mb-4 leading-relaxed">
                    展开这个下界，我们得到：
                </p>
                
                <div class="math-display">
                    \[
                    \mathcal{L} = \mathbb{E} \left[ -\log p_\theta(\mathbf{x}_T) + \sum_{t=1}^T \log \frac{p_\theta(\mathbf{x}_{t-1} | \mathbf{x}_t)}{q(\mathbf{x}_t | \mathbf{x}_{t-1})} \right]
                    \]
                </div>
                
                <p class="text-gray-700 mb-4 leading-relaxed">
                    当T足够大时，\( \mathbf{x}_T \)近似于标准正态分布，因此\( p_\theta(\mathbf{x}_T) = \mathcal{N}(\mathbf{x}_T; \mathbf{0}, \mathbf{I}) \)，这一项可以忽略不计。
                </p>
                
                <h3 class="text-xl font-semibold mb-4 text-dark">4.2 损失函数的分解</h3>
                
                <p class="text-gray-700 mb-4 leading-relaxed">
                    我们可以将ELBO分解为：
                </p>
                
                <div class="math-display">
                    \[
                    \mathcal{L} = \mathcal{L}_T + \sum_{t=1}^{T-1} \mathcal{L}_t - \log p_\theta(\mathbf{x}_0 | \mathbf{x}_1)
                    \]
                </div>
                
                <p class="text-gray-700 mb-4 leading-relaxed">
                    其中：
                </p>
                
                <div class="math-display">
                    \[
                    \mathcal{L}_t = \mathbb{E}_{q} \left[ D_{\text{KL}} \left( q(\mathbf{x}_{t-1} | \mathbf{x}_t, \mathbf{x}_0) \| p_\theta(\mathbf{x}_{t-1} | \mathbf{x}_t) \right) \right]
                    \]
                </div>
                
                <p class="text-gray-700 mb-4 leading-relaxed">
                    由于两个高斯分布之间的KL散度有闭式解，我们可以进一步简化\( \mathcal{L}_t \)。对于高斯分布\( \mathcal{N}(\mu_1, \sigma_1^2) \)和\( \mathcal{N}(\mu_2, \sigma_2^2) \)，它们的KL散度为：
                </p>
                
                <div class="math-display">
                    \[
                    D_{\text{KL}} = \frac{1}{2} \left( \frac{(\mu_1 - \mu_2)^2}{\sigma_2^2} + \frac{\sigma_1^2}{\sigma_2^2} - \log \frac{\sigma_1^2}{\sigma_2^2} - 1 \right)
                    \]
                </div>
                
                <h3 class="text-xl font-semibold mb-4 text-dark">4.3 简化的损失函数</h3>
                
                <p class="text-gray-700 mb-4 leading-relaxed">
                    在DDPM中，作者假设逆向过程的方差是固定的，即\( \Sigma_\theta(\mathbf{x}_t, t) = \sigma_t^2 \mathbf{I} \)，其中\( \sigma_t^2 = \beta_t \)或\( \sigma_t^2 = \frac{1 - \bar{\alpha}_{t-1}}{1 - \bar{\alpha}_t} \beta_t \)。
                </p>
                
                <p class="text-gray-700 mb-4 leading-relaxed">
                    这种情况下，KL散度中的常数项可以忽略，只剩下与均值相关的项。结合之前的噪声重新参数化，我们可以得到最终的损失函数：
                </p>
                
                <div class="math-display">
                    \[
                    \mathcal{L}_{\text{simple}} = \mathbb{E}_{t, \mathbf{x}_0, \boldsymbol{\epsilon}} \left[ \|\boldsymbol{\epsilon} - \boldsymbol{\epsilon}_\theta(\mathbf{x}_t, t)\|^2 \right]
                    \]
                </div>
                
                <p class="text-gray-700 leading-relaxed">
                    其中\( \boldsymbol{\epsilon}_\theta(\mathbf{x}_t, t) \)是神经网络的输出，用于预测添加到\( \mathbf{x}_0 \)中的噪声\( \boldsymbol{\epsilon} \)。这个损失函数非常简单，本质上就是一个MSE损失，这也是扩散模型训练稳定的原因之一。
                </p>
            </section>

            <!-- 5. 采样过程 -->
            <section id="sampling" class="section-fade">
                <div class="flex items-center mb-6">
                    <div class="w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center mr-4">
                        <i class="fa fa-random text-primary"></i>
                    </div>
                    <h2 class="text-3xl font-bold text-dark">采样过程</h2>
                </div>
                
                <p class="text-gray-700 mb-6 leading-relaxed">
                    采样是扩散模型生成新样本的过程，它从随机噪声开始，通过逆向扩散过程逐步生成有意义的数据。虽然训练过程相对简单，但采样过程通常需要较多的步骤(T通常取1000)，这也是扩散模型的一个主要缺点。
                </p>
                
                <h3 class="text-xl font-semibold mb-4 text-dark">5.1 采样算法</h3>
                
                <p class="text-gray-700 mb-4 leading-relaxed">
                    扩散模型的采样算法如下：
                </p>
                
                <div class="bg-gray-50 p-6 rounded-lg border border-gray-200 mb-6">
                    <ol class="list-decimal list-inside space-y-3 text-gray-700">
                        <li>从标准正态分布中采样初始噪声：\( \mathbf{x}_T \sim \mathcal{N}(\mathbf{0}, \mathbf{I}) \)</li>
                        <li>对于t从T到1：
                            <ol class="list-lower-alpha list-inside ml-6 mt-2 space-y-2">
                                <li>使用神经网络预测噪声：\( \boldsymbol{\epsilon}_\theta = \boldsymbol{\epsilon}_\theta(\mathbf{x}_t, t) \)</li>
                                <li>计算逆向过程的均值：\( \boldsymbol{\mu}_\theta = \frac{1}{\sqrt{\alpha_t}} \left( \mathbf{x}_t - \frac{\beta_t}{\sqrt{1 - \bar{\alpha}_t}} \boldsymbol{\epsilon}_\theta \right) \)</li>
                                <li>如果t > 1，从高斯分布采样噪声：\( \mathbf{z} \sim \mathcal{N}(\mathbf{0}, \mathbf{I}) \)；否则，\( \mathbf{z} = \mathbf{0} \)</li>
                                <li>更新样本：\( \mathbf{x}_{t-1} = \boldsymbol{\mu}_\theta + \sigma_t \mathbf{z} \)</li>
                            </ol>
                        </li>
                        <li>返回\( \mathbf{x}_0 \)作为生成的样本</li>
                    </ol>
                </div>
                
                <h3 class="text-xl font-semibold mb-4 text-dark">5.2 采样过程的直观理解</h3>
                
                <p class="text-gray-700 mb-6 leading-relaxed">
                    采样过程可以直观地理解为从完全随机的噪声开始，每一步都根据当前的噪声状态和时间步，预测出可能添加的噪声并部分去除它。随着步骤的进行，样本逐渐从无序的噪声变成有意义的结构。
                </p>
                
                <div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-8">
                    <div class="bg-white p-2 rounded shadow-sm">
                        <img src="https://picsum.photos/id/1015/150/150?random=1" alt="采样步骤T" class="w-full h-auto rounded">
                        <p class="text-xs text-center mt-2 text-gray-500">步骤 T</p>
                    </div>
                    <div class="bg-white p-2 rounded shadow-sm">
                        <img src="https://picsum.photos/id/1015/150/150?random=2" alt="采样步骤T/2" class="w-full h-auto rounded">
                        <p class="text-xs text-center mt-2 text-gray-500">步骤 T/2</p>
                    </div>
                    <div class="bg-white p-2 rounded shadow-sm">
                        <img src="https://picsum.photos/id/1015/150/150?random=3" alt="采样步骤T/4" class="w-full h-auto rounded">
                        <p class="text-xs text-center mt-2 text-gray-500">步骤 T/4</p>
                    </div>
                    <div class="bg-white p-2 rounded shadow-sm">
                        <img src="https://picsum.photos/id/1015/150/150?random=4" alt="采样步骤T/8" class="w-full h-auto rounded">
                        <p class="text-xs text-center mt-2 text-gray-500">步骤 T/8</p>
                    </div>
                    <div class="bg-white p-2 rounded shadow-sm">
                        <img src="https://picsum.photos/id/1015/150/150?random=5" alt="采样步骤0" class="w-full h-auto rounded">
                        <p class="text-xs text-center mt-2 text-gray-500">步骤 0</p>
                    </div>
                </div>
                <p class="text-sm text-gray-500 text-center mb-6">图2: 扩散模型采样过程的示例（从左到右为从噪声到最终图像）</p>
                
                <h3 class="text-xl font-semibold mb-4 text-dark">5.3 加速采样方法</h3>
                
                <p class="text-gray-700 leading-relaxed">
                    由于标准扩散模型的采样过程需要大量步骤，研究人员提出了多种加速采样的方法：
                </p>
                
                <ul class="list-disc list-inside space-y-2 text-gray-700 mb-4">
                    <li><strong>减少步骤数</strong>：如DPM-Solver等方法，通过设计更高效的数值积分方法，在保持生成质量的同时大幅减少采样步骤</li>
                    <li><strong>知识蒸馏</strong>：训练一个新的模型来模拟原始模型的多步采样过程</li>
                    <li><strong>自适应调度</strong>：根据样本质量动态调整采样步骤，在关键阶段使用更多步骤</li>
                </ul>
                
                <p class="text-gray-700 leading-relaxed">
                    这些方法已经能够将采样步骤从1000步减少到10-20步，同时保持接近原始模型的生成质量，极大地提升了扩散模型的实用性。
                </p>
            </section>

            <!-- 6. 扩展模型与实际应用 -->
            <section id="extensions" class="section-fade">
                <div class="flex items-center mb-6">
                    <div class="w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center mr-4">
                        <i class="fa fa-puzzle-piece text-primary"></i>
                    </div>
                    <h2 class="text-3xl font-bold text-dark">扩展模型与实际应用</h2>
                </div>
                
                <p class="text-gray-700 mb-6 leading-relaxed">
                    自DDPM提出以来，研究人员提出了许多改进和扩展模型，大大提升了扩散模型的性能和适用范围。同时，扩散模型在多个领域也得到了广泛应用。
                </p>
                
                <h3 class="text-xl font-semibold mb-4 text-dark">6.1 重要的扩展模型</h3>
                
                <div class="space-y-6 mb-8">
                    <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-100">
                        <h4 class="font-semibold text-lg mb-2 text-primary">Stable Diffusion</h4>
                        <p class="text-gray-700">
                            Stable Diffusion是目前最流行的扩散模型之一，它通过引入潜在空间(latent space)大大提高了扩散模型的效率。与直接在像素空间操作不同，Stable Diffusion首先将图像压缩到一个低维潜在空间，在这个空间中进行扩散过程，最后再映射回像素空间。这使得模型更小、速度更快，同时保持了高质量的生成效果。
                        </p>
                    </div>
                    
                    <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-100">
                        <h4 class="font-semibold text-lg mb-2 text-primary">Imagen 和 DALL-E 2</h4>
                        <p class="text-gray-700">
                            Imagen和DALL-E 2是两个领先的文本到图像生成模型，它们都采用了扩散模型作为核心生成组件。这些模型结合了大型语言模型(LLM)作为文本编码器，能够生成与文本描述高度匹配的高质量图像。Imagen特别强调了通过在更大的数据集上训练来提高生成质量。
                        </p>
                    </div>
                    
                    <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-100">
                        <h4 class="font-semibold text-lg mb-2 text-primary">ControlNet</h4>
                        <p class="text-gray-700">
                            ControlNet是对扩散模型的一种扩展，它允许用户通过额外的控制信号（如边缘检测、深度图、姿态估计等）来引导图像生成过程。这种方法保持了原始扩散模型的生成质量，同时提供了精确的生成控制，极大地扩展了扩散模型在创意设计和内容生成中的应用。
                        </p>
                    </div>
                </div>
                
                <h3 class="text-xl font-semibold mb-4 text-dark">6.2 实际应用领域</h3>
                
                <div class="grid md:grid-cols-2 gap-6 mb-6">
                    <div class="flex">
                        <div class="flex-shrink-0 w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center mr-4">
                            <i class="fa fa-image text-primary text-xl"></i>
                        </div>
                        <div>
                            <h4 class="font-semibold mb-2">图像生成与编辑</h4>
                            <p class="text-gray-700 text-sm">
                                扩散模型能够生成高质量的图像，支持文本引导的图像生成、图像编辑、风格迁移等任务。
                            </p>
                        </div>
                    </div>
                    
                    <div class="flex">
                        <div class="flex-shrink-0 w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center mr-4">
                            <i class="fa fa-video-camera text-primary text-xl"></i>
                        </div>
                        <div>
                            <h4 class="font-semibold mb-2">视频生成</h4>
                            <p class="text-gray-700 text-sm">
                                扩展到视频领域，扩散模型能够生成和编辑视频内容，保持时间上的一致性。
                            </p>
                        </div>
                    </div>
                    
                    <div class="flex">
                        <div class="flex-shrink-0 w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center mr-4">
                            <i class="fa fa-microphone text-primary text-xl"></i>
                        </div>
                        <div>
                            <h4 class="font-semibold mb-2">语音合成</h4>
                            <p class="text-gray-700 text-sm">
                                在语音领域，扩散模型用于高质量语音合成，能够生成自然、流畅的语音。
                            </p>
                        </div>
                    </div>
                    
                    <div class="flex">
                        <div class="flex-shrink-0 w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center mr-4">
                            <i class="fa fa-stethoscope text-primary text-xl"></i>
                        </div>
                        <div>
                            <h4 class="font-semibold mb-2">医疗影像</h4>
                            <p class="text-gray-700 text-sm">
                                扩散模型用于医学图像生成、增强和分割，辅助医生进行疾病诊断。
                            </p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 7. 总结与展望 -->
            <section id="summary" class="section-fade">
                <div class="flex items-center mb-6">
                    <div class="w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center mr-4">
                        <i class="fa fa-flag-checkered text-primary"></i>
                    </div>
                    <h2 class="text-3xl font-bold text-dark">总结与展望</h2>
                </div>
                
                <p class="text-gray-700 mb-6 leading-relaxed">
                    扩散模型作为一种强大的生成模型，在近年来取得了显著的进展，成为生成式AI领域的重要技术之一。
                </p>
                
                <h3 class="text-xl font-semibold mb-4 text-dark">7.1 主要优势</h3>
                
                <ul class="list-disc list-inside space-y-2 text-gray-700 mb-6">
                    <li>训练过程稳定，不存在GANs中的模式崩溃和训练不稳定问题</li>
                    <li>生成质量高，能够生成高度逼真的图像和其他类型的数据</li>
                    <li>易于扩展和修改，可以通过各种方式引导生成过程</li>
                    <li>理论基础坚实，有明确的数学解释</li>
                </ul>
                
                <h3 class="text-xl font-semibold mb-4 text-dark">7.2 面临的挑战</h3>
                
                <ul class="list-disc list-inside space-y-2 text-gray-700 mb-6">
                    <li>采样速度慢，需要大量步骤才能生成高质量样本</li>
                    <li>模型通常较大，需要大量计算资源进行训练和推理</li>
                    <li>在某些任务上（如生成长文本）的表现仍不及其他模型</li>
                    <li>对训练数据的质量和数量要求较高</li>
                </ul>
                
                <h3 class="text-xl font-semibold mb-4 text-dark">7.3 未来研究方向</h3>
                
                <p class="text-gray-700 mb-4 leading-relaxed">
                    扩散模型的未来研究可能会集中在以下几个方向：
                </p>
                
                <div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-6 rounded-lg border border-blue-100 mb-6">
                    <ol class="list-decimal list-inside space-y-3 text-gray-700">
                        <li><strong>提高采样效率</strong>：开发更高效的采样算法，进一步减少采样步骤</li>
                        <li><strong>模型压缩与加速</strong>：研究模型压缩和量化技术，使扩散模型能够在资源受限的设备上运行</li>
                        <li><strong>多模态生成</strong>：扩展扩散模型到更多模态，实现跨模态生成和转换</li>
                        <li><strong>可控生成</strong>：开发更精细的控制机制，允许用户精确控制生成内容的各个方面</li>
                        <li><strong>小数据学习</strong>：研究如何在有限的数据下训练高质量的扩散模型</li>
                    </ol>
                </div>
                
                <p class="text-gray-700 leading-relaxed">
                    随着研究的深入，扩散模型有望在更多领域得到应用，为人工智能的发展带来新的突破。无论是在学术研究还是工业应用中，扩散模型都将继续发挥重要作用，推动生成式AI技术的进步。
                </p>
            </section>

            <!-- 参考文献 -->
            <section class="section-fade">
                <div class="flex items-center mb-6">
                    <div class="w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center mr-4">
                        <i class="fa fa-book text-primary"></i>
                    </div>
                    <h2 class="text-3xl font-bold text-dark">参考文献</h2>
                </div>
                
                <ul class="space-y-4 text-gray-700 mb-6 list-decimal list-inside">
                    <li>
                        Sohl-Dickstein, J., Weiss, E., Maheswaranathan, N., & Ganguli, S. (2015). Deep unsupervised learning using nonequilibrium thermodynamics. <em>International Conference on Machine Learning</em>.
                    </li>
                    <li>
                        Ho, J., Jain, A., & Abbeel, P. (2020). Denoising diffusion probabilistic models. <em>Neural Information Processing Systems</em>.
                    </li>
                    <li>
                        Dhariwal, P., & Nichol, A. (2021). Improved denoising diffusion probabilistic models. <em>International Conference on Machine Learning</em>.
                    </li>
                    <li>
                        Rombach, R., Blattmann, A., Lorenz, D., Esser, P., & Ommer, B. (2022). High-resolution image synthesis with latent diffusion models. <em>IEEE/CVF Conference on Computer Vision and Pattern Recognition</em>.
                    </li>
                    <li>
                        Saharia, C., Chan, W., Saxena, S., et al. (2022). Photorealistic text-to-image diffusion models with deep language understanding. <em>Neural Information Processing Systems</em>.
                    </li>
                    <li>
                        Zhang, L., Agrawala, M. (2023). Adding conditional control to text-to-image diffusion models. <em>IEEE/CVF Conference on Computer Vision and Pattern Recognition</em>.
                    </li>
                </ul>
            </section>
        </div>
    </main>

    <!-- 页脚 -->
    <footer class="bg-dark text-gray-300 py-12 mt-16">
        <div class="container mx-auto px-4">
            <div class="max-w-4xl mx-auto">
                <div class="flex flex-col md:flex-row justify-between items-center mb-8">
                    <div class="flex items-center mb-6 md:mb-0">
                        <i class="fa fa-line-chart text-primary text-2xl mr-2"></i>
                        <h2 class="text-xl font-bold text-white">扩散模型详解</h2>
                    </div>
                    <div class="flex space-x-4">
                        <a href="#" class="text-gray-400 hover:text-primary transition-colors">
                            <i class="fa fa-github text-xl"></i>
                        </a>
                        <a href="#" class="text-gray-400 hover:text-primary transition-colors">
                            <i class="fa fa-twitter text-xl"></i>
                        </a>
                        <a href="#" class="text-gray-400 hover:text-primary transition-colors">
                            <i class="fa fa-linkedin text-xl"></i>
                        </a>
                    </div>
                </div>
                
                <div class="border-t border-gray-700 pt-8 text-center text-sm text-gray-400">
                    <p>© 2023 AI技术博客. 保留所有权利.</p>
                    <p class="mt-2">本文档仅供学习参考，转载请注明出处.</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- 返回顶部按钮 -->
    <button id="backToTop" class="fixed bottom-6 right-6 bg-primary text-white w-12 h-12 rounded-full flex items-center justify-center shadow-lg opacity-0 invisible transition-all duration-300 hover:bg-primary/90">
        <i class="fa fa-arrow-up"></i>
    </button>

    <!-- JavaScript -->
    <script>
        // 移动端菜单切换
        const menuBtn = document.getElementById('menuBtn');
        const mobileMenu = document.getElementById('mobileMenu');
        
        menuBtn.addEventListener('click', () => {
            mobileMenu.classList.toggle('hidden');
        });
        
        // 平滑滚动
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                
                // 关闭移动菜单（如果打开）
                if (!mobileMenu.classList.contains('hidden')) {
                    mobileMenu.classList.add('hidden');
                }
                
                document.querySelector(this.getAttribute('href')).scrollIntoView({
                    behavior: 'smooth'
                });
            });
        });
        
        // 返回顶部按钮
        const backToTopBtn = document.getElementById('backToTop');
        
        window.addEventListener('scroll', () => {
            if (window.scrollY > 300) {
                backToTopBtn.classList.remove('opacity-0', 'invisible');
                backToTopBtn.classList.add('opacity-100', 'visible');
            } else {
                backToTopBtn.classList.remove('opacity-100', 'visible');
                backToTopBtn.classList.add('opacity-0', 'invisible');
            }
            
            // 导航栏滚动效果
            const header = document.querySelector('header');
            if (window.scrollY > 100) {
                header.classList.add('py-2', 'shadow');
                header.classList.remove('py-4');
            } else {
                header.classList.add('py-4');
                header.classList.remove('py-2', 'shadow');
            }
            
            // 滚动动画
            const sections = document.querySelectorAll('.section-fade');
            sections.forEach(section => {
                const sectionTop = section.getBoundingClientRect().top;
                const windowHeight = window.innerHeight;
                
                if (sectionTop < windowHeight * 0.75) {
                    section.classList.add('section-visible');
                }
            });
        });
        
        backToTopBtn.addEventListener('click', () => {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        });
        
        // 扩散过程图表
        const ctx = document.getElementById('diffusionChart').getContext('2d');
        const diffusionChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: Array.from({length: 11}, (_, i) => i * 100),
                datasets: [
                    {
                        label: '信号强度',
                        data: [1.0, 0.85, 0.72, 0.61, 0.52, 0.43, 0.35, 0.28, 0.21, 0.14, 0.0],
                        borderColor: '#3B82F6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        tension: 0.4,
                        fill: true
                    },
                    {
                        label: '噪声强度',
                        data: [0.0, 0.15, 0.28, 0.39, 0.48, 0.57, 0.65, 0.72, 0.79, 0.86, 1.0],
                        borderColor: '#10B981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        tension: 0.4,
                        fill: true
                    }
                ]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'top',
                    },
                    title: {
                        display: true,
                        text: '扩散过程中的信号与噪声变化'
                    }
                },
                scales: {
                    y: {
                        min: 0,
                        max: 1,
                        title: {
                            display: true,
                            text: '相对强度'
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: '扩散步骤'
                        }
                    }
                }
            }
        });
        
        // 页面加载时触发一次滚动检查，以显示初始可见的部分
        window.addEventListener('load', () => {
            window.dispatchEvent(new Event('scroll'));
        });
    </script>
</body>
</html>
